name: 🚚 Release All
on:
  release:
    types: released

jobs:
  release-vscode:
    name: 🖥️ Release VSCode
    uses: Blockception/minecraft-bedrock-language-server/.github/workflows/release-ide.yaml@main
    secrets: inherit

  update-release:
    name: 📦➡️ GitHub Release Assets
    runs-on: ubuntu-latest
    needs:
      - release-vscode
    permissions:
      contents: write
    steps:
      - name: ⬇️ Download all workflow artifacts
        uses: actions/download-artifact@v4
        with:
          # Collect every artifact produced by prerequisite jobs (e.g., vscode-extension)
          pattern: '*'
          merge-multiple: true
          path: release-assets

      - name: 🧾 List downloaded assets
        run: |
          echo "Downloaded assets:" >> $GITHUB_STEP_SUMMARY
          if [ -d release-assets ]; then
            tree -h release-assets >> $GITHUB_STEP_SUMMARY || ls -lah release-assets >> $GITHUB_STEP_SUMMARY
          else
            echo "No artifacts were downloaded." >> $GITHUB_STEP_SUMMARY
          fi

      - name: 🚀 Upload assets to GitHub Release
        if: ${{ hashFiles('release-assets/**') != '' }}
        uses: softprops/action-gh-release@v2
        with:
          tag_name: ${{ github.event.release.tag_name }}
          files: |
            release-assets/**
          draft: false
          prerelease: false
          append_body: false
          fail_on_unmatched_files: false
          generate_release_notes: false
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}